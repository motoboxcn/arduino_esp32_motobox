# ESP32-S3 MotoBox 轻量化版本开发指南

## 项目概述
本项目是基于ESP32-S3的摩托车数据采集与监控系统轻量化版本，专注于核心功能和低功耗设计。

## 🎯 产品定位
**摩托车数据黑匣子系统** - 专为摩托车设计的轻量化数据采集与远程监控解决方案

## 🚀 核心功能特性

### 📡 **4G 通信模块**
- **Air780EG 集成模块**：内置4G LTE + GNSS定位
- **MQTT 数据上报**：实时位置、状态数据上传至云端
- **低功耗设计**：支持休眠唤醒，延长电池续航

### 🛰️ **智能定位系统**
- **IMU + GNSS 融合定位**：QMI8658A 9轴传感器 + 卫星定位
- **骑行轨迹记录**：实时记录行驶路径，支持历史轨迹回放

### ⚡ **智能电源管理**
- **双电源模式**：电池供电 + 车辆电门供电
- **自动休眠机制**：静止状态自动进入深度睡眠
- **震动唤醒**：IMU检测震动自动唤醒系统
- **电量监控**：实时电池状态监测与低电量保护

### 📊 **数据采集与分析**
- **倾角统计**：实时监测车辆倾斜角度
- **运动状态检测**：行驶/静止状态智能识别
- **环境数据记录**：温度、湿度等环境参数采集

## 🔧 技术架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   传感器层      │    │   处理层        │    │   通信层        │
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ • QMI8658A IMU │───▶│ • ESP32 MCU  │───▶│ • Air780EG 4G   │
│ • GNSS接收机   │    │ • 数据融合算法  │    │ • MQTT协议      │
│ • 环境传感器   │    │ • 电源管理      │    │ • 云端服务      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 🛠️ 工作模式

| 模式 | 功能 | 功耗 | 适用场景 |
|------|------|------|----------|
| **活跃模式** | 全功能运行 | 高 | 行驶中、数据采集 |
| **待机模式** | 基础监控 | 中 | 停车、等待状态 |
| **休眠模式** | 震动唤醒 | 极低 | 长时间静止 |

## 🔋 电源特性

- **工作电压**：3.3V - 4.2V
- **待机功耗**：< 50μA
- **工作功耗**：< 100mA
- **电池续航**：7-30天（取决于使用频率）

## 📱 远程管理

- **实时监控**：通过MQTT实时获取设备状态
- **远程配置**：支持OTA固件升级
- **数据同步**：云端数据存储与分析
- **告警通知**：异常状态实时推送

## 编译和烧录

```bash
# 编译轻量化版本
pio run --environment esp32-air780eg

# 烧录固件
pio run --environment esp32-air780eg --target upload
```

## 发布固件
```bash
# 检查版本状态
python3 tools/firmware_release.py --status

# 发布当前版本
python3 tools/firmware_release.py --release

# 发布指定版本
python3 tools/firmware_release.py --release --version v5.0.0

# 查看所有版本
python3 tools/firmware_release.py --list
```

## 开发日志
- 2025-09-01 v5.0.0 轻量化版本，移除TFT显示、BLE通信、WiFi配置等非核心功能，专注于数据采集和4G通信；
- 2025-07-14 v4.1.0 支持sd卡升级，支持sd卡升级；
- 2025-07-12 v4.0.0 完全使用air780eg模块，支持蓝牙配置，支持mqtt配置，支持sd卡存储，支持低功耗模式，支持休眠时间设置与获取；

## 轻量化版本特点

### ✅ 保留的核心功能
- **Air780EG 4G通信** - 核心通信功能
- **IMU传感器** - 运动检测和融合定位
- **GNSS定位** - 卫星定位功能
- **SD卡存储** - 数据记录和固件升级
- **电源管理** - 低功耗和电池管理
- **LED指示** - 状态指示和调试
- **音频提示** - 语音反馈
- **罗盘功能** - 方向检测
- **OTA升级** - 固件更新

### ❌ 移除的功能
- **TFT显示屏** - 减少功耗和复杂度
- **BLE通信** - 简化通信架构
- **WiFi配置** - 减少配置复杂度
- **按钮控制** - 简化硬件接口
- **UI界面库** - 无显示需求

这个轻量化版本专注于核心功能，去除了复杂的显示界面和冗余功能，为摩托车数据采集提供了高效、可靠的解决方案。

## 许可证

本项目采用 GNU General Public License v3.0 (GPL-3.0) 开源许可证，并附加 Commons Clause 限制条款，禁止商业使用。

详细许可证条款请参见项目根目录下的 `LICENSE` 文件。

## 免责声明

本项目旨在提供有用的功能，但不保证完全没有缺陷。使用本项目所造成的任何损失，作者概不负责。

## 贡献

欢迎通过以下方式参与项目：
- 提交 Issues 报告 Bug 或建议新功能
- 发起 Pull Requests 改进代码
- 分享使用心得和二次开发经验

请遵守项目的代码风格和贡献准则。


