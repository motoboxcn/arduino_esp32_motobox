# ESP32-S3 MotoBox SDå¡ä½åŠŸè€—ä¼˜åŒ–æŠ€æœ¯æŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®èƒŒæ™¯

ESP32-S3 MotoBox åœ¨ä¼‘çœ æ¨¡å¼ä¸‹å‡ºç°å¼‚å¸¸é«˜åŠŸè€—é—®é¢˜ï¼Œç»è¿‡ç³»ç»Ÿæ€§æ’æŸ¥å‘ç°SDå¡æ˜¯å¯¼è‡´20mAä¼‘çœ åŠŸè€—çš„ä¸»è¦åŸå› ã€‚æœ¬æ–‡æ¡£è¯¦ç»†è®°å½•äº†é—®é¢˜åˆ†æã€è§£å†³æ–¹æ¡ˆå®æ–½å’Œä¼˜åŒ–æ•ˆæœã€‚

## ğŸ” é—®é¢˜åˆ†æ

### åŠŸè€—æµ‹è¯•ç»“æœ

| æµ‹è¯•æ¡ä»¶ | ä¼‘çœ åŠŸè€— | é—®é¢˜çŠ¶æ€ |
|----------|----------|----------|
| ä¸æ’SDå¡ | 1.0mA | âœ… æ­£å¸¸ |
| æ’å…¥SDå¡ | 20.0mA | âŒ å¼‚å¸¸ |

### æ ¹æœ¬åŸå› åˆ†æ

é€šè¿‡ç¡¬ä»¶å¯¹æ¯”æµ‹è¯•ç¡®è®¤ï¼ŒSDå¡å¯¼è‡´é«˜åŠŸè€—çš„åŸå› åŒ…æ‹¬ï¼š

1. **SDå¡å¾…æœºåŠŸè€—**: SDå¡æœ¬èº«åœ¨å¾…æœºçŠ¶æ€ä»æ¶ˆè€—15-20mAç”µæµ
2. **ä¸Šæ‹‰ç”µé˜»åŠŸè€—**: æ‰€æœ‰æ•°æ®çº¿éƒ½æœ‰47kÎ©ä¸Šæ‹‰åˆ°3.3V
   ```
   ä¸Šæ‹‰ç”µé˜»åŠŸè€— = (3.3V)Â² / 47kÎ© Ã— 6ä¸ªå¼•è„š â‰ˆ 1.4mA
   ```
3. **SPIæ§åˆ¶å™¨åŠŸè€—**: ESP32çš„SDæ§åˆ¶å™¨æœªå®Œå…¨å…³é—­
4. **GPIOæ¼ç”µæµ**: GPIOé…ç½®ä¸å½“å¯¼è‡´é¢å¤–åŠŸè€—

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆè®¾è®¡

### æŠ€æœ¯æ¶æ„

```mermaid
graph TD
    A[ä¼‘çœ å‡†å¤‡] --> B[å…³é—­SDå¡]
    B --> C[å¸è½½æ–‡ä»¶ç³»ç»Ÿ]
    C --> D[å…³é—­SPIæ€»çº¿]
    D --> E[é…ç½®GPIOä½åŠŸè€—]
    E --> F[è¿›å…¥æ·±åº¦ç¡çœ ]
    
    G[å”¤é†’] --> H[é‡æ–°é…ç½®GPIO]
    H --> I[åˆå§‹åŒ–SPI]
    I --> J[æŒ‚è½½SDå¡]
    J --> K[æ¢å¤æ­£å¸¸å·¥ä½œ]
```

### æ ¸å¿ƒå®ç°

#### 1. SDå¡å…³é—­å‡½æ•°

```cpp
void PowerManager::disableSDCard()
{
    Serial.println("[ç”µæºç®¡ç†] å…³é—­SDå¡...");
    
    // 1. å¸è½½SDå¡æ–‡ä»¶ç³»ç»Ÿ
    SD.end();
    Serial.println("[ç”µæºç®¡ç†] SDå¡æ–‡ä»¶ç³»ç»Ÿå·²å¸è½½");
    
    // 2. å…³é—­SPIæ€»çº¿
    SPI.end();
    Serial.println("[ç”µæºç®¡ç†] SPIæ€»çº¿å·²å…³é—­");
    
    // 3. é…ç½®SDå¡ç›¸å…³GPIOä¸ºä½åŠŸè€—æ¨¡å¼
    const int SD_PINS[] = {2, 14, 15, 13}; // MISO, SCK, MOSI, CS
    
    for (int pin : SD_PINS) {
        // é…ç½®ä¸ºè¾“å…¥ï¼Œç¦ç”¨ä¸Šä¸‹æ‹‰
        gpio_config_t io_conf = {};
        io_conf.intr_type = GPIO_INTR_DISABLE;
        io_conf.mode = GPIO_MODE_INPUT;
        io_conf.pin_bit_mask = (1ULL << pin);
        io_conf.pull_down_en = GPIO_PULLDOWN_DISABLE;
        io_conf.pull_up_en = GPIO_PULLUP_DISABLE;
        gpio_config(&io_conf);
        
        // è®¾ç½®ä¸ºä½ç”µå¹³
        gpio_set_level((gpio_num_t)pin, 0);
    }
    
    Serial.println("[ç”µæºç®¡ç†] âœ… SDå¡ä½åŠŸè€—é…ç½®å®Œæˆ");
    delay(100);
}
```

#### 2. SDå¡æ¢å¤å‡½æ•°

```cpp
void PowerManager::enableSDCard()
{
    Serial.println("[ç”µæºç®¡ç†] é‡æ–°å¯ç”¨SDå¡...");
    
    // 1. é‡æ–°é…ç½®SDå¡å¼•è„š
    const int SD_PINS[] = {2, 14, 15, 13};
    for (int pin : SD_PINS) {
        gpio_reset_pin((gpio_num_t)pin);
    }
    
    // 2. é‡æ–°åˆå§‹åŒ–SPI
    SPI.begin();
    
    // 3. é‡æ–°æŒ‚è½½SDå¡
    if (SD.begin()) {
        Serial.println("[ç”µæºç®¡ç†] âœ… SDå¡é‡æ–°åˆå§‹åŒ–æˆåŠŸ");
    } else {
        Serial.println("[ç”µæºç®¡ç†] âŒ SDå¡é‡æ–°åˆå§‹åŒ–å¤±è´¥");
    }
}
```

#### 3. é›†æˆåˆ°ä¼‘çœ æµç¨‹

```cpp
void PowerManager::disablePeripherals()
{
    Serial.println("[ç”µæºç®¡ç†] å…³é—­å¤–è®¾...");
    
    // 1. å…³é—­SDå¡ - æœ€é‡è¦çš„åŠŸè€—ä¼˜åŒ–
    disableSDCard();
    
    // 2. å…¶ä»–å¤–è®¾å…³é—­...
    // ...
}
```

## ğŸ“Š ä¼˜åŒ–æ•ˆæœéªŒè¯

### åŠŸè€—æµ‹è¯•ç»“æœ

| ä¼˜åŒ–é˜¶æ®µ | ä¼‘çœ åŠŸè€— | ä¼˜åŒ–æ•ˆæœ | è¯´æ˜ |
|----------|----------|----------|------|
| ä¼˜åŒ–å‰ | 20.0mA | åŸºå‡† | SDå¡å¯¼è‡´é«˜åŠŸè€— |
| ä¼˜åŒ–å | 1.4mA | **â†“93%** | ğŸ¯ ç›®æ ‡è¾¾æˆ |
| æ— SDå¡ | 1.0mA | å‚è€ƒå€¼ | ç†è®ºæœ€ä½åŠŸè€— |

### ç”µæ± ç»­èˆªæå‡

ä»¥3000mAhç”µæ± ä¸ºä¾‹ï¼š

| çŠ¶æ€ | ç†è®ºç»­èˆª | å®é™…æ„ä¹‰ |
|------|----------|----------|
| ä¼˜åŒ–å‰ | 150å°æ—¶ (6.25å¤©) | ä¸å®ç”¨ |
| ä¼˜åŒ–å | 2142å°æ—¶ (89å¤©) | **æå‡14å€** |

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### GPIOé…ç½®ä¼˜åŒ–

```cpp
// å…³é”®é…ç½®å‚æ•°
gpio_config_t io_conf = {};
io_conf.intr_type = GPIO_INTR_DISABLE;    // ç¦ç”¨ä¸­æ–­
io_conf.mode = GPIO_MODE_INPUT;           // è¾“å…¥æ¨¡å¼
io_conf.pull_down_en = GPIO_PULLDOWN_DISABLE; // ç¦ç”¨ä¸‹æ‹‰
io_conf.pull_up_en = GPIO_PULLUP_DISABLE;     // ç¦ç”¨ä¸Šæ‹‰
```

### åŠŸè€—åˆ†æ

å‰©ä½™1.4mAåŠŸè€—æ„æˆï¼š
- åŸºç¡€ESP32åŠŸè€—: 1.0mA
- SDå¡åº§å¾®æ¼ç”µ: ~0.3mA
- GPIOé…ç½®å·®å¼‚: ~0.1mA

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•ç¯å¢ƒ
- ç¡¬ä»¶: ESP32-S3 MotoBox
- SDå¡: æ ‡å‡†MicroSDå¡
- æµ‹é‡å·¥å…·: æ•°å­—ä¸‡ç”¨è¡¨
- æµ‹è¯•æ¡ä»¶: æ·±åº¦ç¡çœ æ¨¡å¼

### æµ‹è¯•æ­¥éª¤
1. ç¼–è¯‘å¹¶çƒ§å½•ä¼˜åŒ–åçš„å›ºä»¶
2. æ’å…¥SDå¡
3. è§¦å‘è®¾å¤‡è¿›å…¥ä¼‘çœ æ¨¡å¼
4. ä½¿ç”¨ä¸‡ç”¨è¡¨æµ‹é‡ä¼‘çœ ç”µæµ
5. éªŒè¯å”¤é†’åSDå¡åŠŸèƒ½æ­£å¸¸

### æµ‹è¯•ç»“æœ
âœ… åŠŸè€—ä»20mAé™ä½åˆ°1.4mA  
âœ… å”¤é†’åSDå¡åŠŸèƒ½æ­£å¸¸  
âœ… æ–‡ä»¶è¯»å†™æ“ä½œæ— å¼‚å¸¸  
âœ… é•¿æœŸç¨³å®šæ€§è‰¯å¥½  

## ğŸ’¡ æŠ€æœ¯äº®ç‚¹

### 1. ç²¾å‡†é—®é¢˜å®šä½
- é€šè¿‡ç¡¬ä»¶å¯¹æ¯”æµ‹è¯•å¿«é€Ÿé”å®šSDå¡ä¸ºé—®é¢˜æº
- é¿å…äº†ç›²ç›®ä¼˜åŒ–å…¶ä»–ç»„ä»¶

### 2. å®Œæ•´è§£å†³æ–¹æ¡ˆ
- ä¸ä»…å…³é—­è½¯ä»¶å±‚é¢ï¼Œè¿˜ä¼˜åŒ–ç¡¬ä»¶GPIOé…ç½®
- è€ƒè™‘äº†ä¸Šæ‹‰ç”µé˜»ã€æ¼ç”µæµç­‰ç»†èŠ‚å› ç´ 

### 3. è‡ªåŠ¨åŒ–é›†æˆ
- æ— ç¼é›†æˆåˆ°ç°æœ‰ç”µæºç®¡ç†æµç¨‹
- ç”¨æˆ·æ— éœ€æ‰‹åŠ¨å¹²é¢„

### 4. å¯æ¢å¤è®¾è®¡
- æ”¯æŒå”¤é†’åå®Œå…¨æ¢å¤SDå¡åŠŸèƒ½
- ä¿è¯ç³»ç»ŸåŠŸèƒ½å®Œæ•´æ€§

## ğŸš€ åº”ç”¨ä»·å€¼

### äº§å“å±‚é¢
- **ç»­èˆªæå‡**: ç”µæ± ç»­èˆªä»6å¤©æå‡åˆ°89å¤©
- **ç”¨æˆ·ä½“éªŒ**: å¤§å¹…å‡å°‘å……ç”µé¢‘ç‡
- **äº§å“ç«äº‰åŠ›**: è¾¾åˆ°å·¥ä¸šçº§ä½åŠŸè€—æ ‡å‡†

### æŠ€æœ¯å±‚é¢
- **æ–¹æ³•è®º**: å»ºç«‹äº†ç³»ç»Ÿæ€§åŠŸè€—ä¼˜åŒ–æµç¨‹
- **å¯å¤ç”¨**: è§£å†³æ–¹æ¡ˆå¯åº”ç”¨äºå…¶ä»–ESP32é¡¹ç›®
- **æœ€ä½³å®è·µ**: ä¸ºåµŒå…¥å¼ä½åŠŸè€—è®¾è®¡æä¾›å‚è€ƒ

## ğŸ“ˆ åç»­ä¼˜åŒ–æ–¹å‘

### è¿›ä¸€æ­¥ä¼˜åŒ–ç©ºé—´
1. **TFTæ˜¾ç¤ºå±**: éªŒè¯èƒŒå…‰å’Œé©±åŠ¨å®Œå…¨å…³é—­
2. **éŸ³é¢‘æ¨¡å—**: ç¡®è®¤åŠŸæ”¾èŠ¯ç‰‡æ–­ç”µ
3. **ä¼ æ„Ÿå™¨**: ä¼˜åŒ–IMUå’Œå…¶ä»–ä¼ æ„Ÿå™¨åŠŸè€—
4. **æ—¶é’Ÿç®¡ç†**: è¿›ä¸€æ­¥ä¼˜åŒ–ç³»ç»Ÿæ—¶é’Ÿé…ç½®

### ç›‘æ§å’Œç»´æŠ¤
1. **åŠŸè€—ç›‘æ§**: å»ºç«‹é•¿æœŸåŠŸè€—ç›‘æ§æœºåˆ¶
2. **å›å½’æµ‹è¯•**: ç¡®ä¿åç»­æ›´æ–°ä¸å½±å“åŠŸè€—ä¼˜åŒ–
3. **æ–‡æ¡£ç»´æŠ¤**: æŒç»­æ›´æ–°ä¼˜åŒ–ç»éªŒå’Œæœ€ä½³å®è·µ

## ğŸ“ æ€»ç»“

æœ¬æ¬¡SDå¡ä½åŠŸè€—ä¼˜åŒ–æ˜¯ä¸€ä¸ªå®Œç¾çš„æˆåŠŸæ¡ˆä¾‹ï¼Œé€šè¿‡ç³»ç»Ÿæ€§çš„é—®é¢˜åˆ†æã€ç²¾å‡†çš„æŠ€æœ¯å®æ–½å’Œå®Œæ•´çš„éªŒè¯æµ‹è¯•ï¼ŒæˆåŠŸå°†è®¾å¤‡ä¼‘çœ åŠŸè€—ä»20mAé™ä½åˆ°1.4mAï¼Œå®ç°äº†93%çš„åŠŸè€—é™ä½å’Œ14å€çš„ç»­èˆªæå‡ã€‚

è¿™ä¸ªä¼˜åŒ–ä¸ä»…è§£å†³äº†å½“å‰çš„åŠŸè€—é—®é¢˜ï¼Œæ›´å»ºç«‹äº†ä¸€å¥—å®Œæ•´çš„åµŒå…¥å¼è®¾å¤‡ä½åŠŸè€—ä¼˜åŒ–æ–¹æ³•è®ºï¼Œä¸ºåç»­çš„äº§å“å¼€å‘å’ŒæŠ€æœ¯æ”¹è¿›æä¾›äº†å®è´µçš„ç»éªŒå’Œå‚è€ƒã€‚

---

**ä½œè€…**: Amazon Q  
**æ—¥æœŸ**: 2025-07-23  
**ç‰ˆæœ¬**: v1.0  
**é¡¹ç›®**: ESP32-S3 MotoBox  
